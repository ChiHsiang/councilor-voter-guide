{% extends "base.html" %}
{% load socialaccount %}

{% block title %}
    {% with councilor=bill.primary_proposer.0 %}
        <title>議員投票指南:{{county}}-{{ councilor.name }}的提案</title>
        <meta property="og:title" content="議員投票指南:{{county}}-{{ councilor.name }}提的提案"/>
        <meta itemprop="name" content="議員投票指南:{{county}}-{{ councilor.name }}提的提案">
    {% endwith %}
{% endblock title %}

{% block right %}
<div class="row">
    <div class="col-sm-3">
        <h3>
            <i class="fa fa-pencil text-danger"> 主提案</i>
        </h3>
        {% if bill.param.sponsors_groupby_party.priproposer %}
            {% include "common/sponsor.html" with list=bill.param.sponsors_groupby_party.priproposer.party_list role="priproposer" %}
        {% else %}
            {{bill.proposed_by}}
        {% endif %}
        {% if bill.param.sponsors_groupby_party.sponsor %}
        <h3>
            <i class="fa fa-group text-success"> 其他提案人</i>
        </h3>
            {% include "common/sponsor.html" with list=bill.param.sponsors_groupby_party.sponsor.party_list role="sponsor" %}
        {% endif %}
        {% if bill.petitioned_by %}
            <h3>
                <i class="fa fa-plus-circle text-warning"> 連署提案</i>
            </h3>
            {% if bill.param.sponsors_groupby_party.cosponsor %}
                {% include "common/sponsor.html" with list=bill.param.sponsors_groupby_party.cosponsor.party_list role="cosponsor" %}
            {% else %}
                {{bill.petitioned_by}}
            {% endif %}
        {% endif %}
        <div id="d3" align="left">
        </div>
    </div>
    <div class="col-sm-5" style="background-color: #fff;">
        <br>
        {% if bill %}
        {% if bill.links.0.url %}
            <a href="{{bill.links.0.url}}" target="_blank" class="lead pull-right"><i class="fa fa-info-circle"> 官方連結</i></a>
        {% else %}
            <a href="{{bill.link}}" target="_blank" class="lead pull-right"><i class="fa fa-info-circle"> 官方連結</i></a>
        {% endif %}
        <div align="center">
            <ul class="list-inline lead">
                <li>{{bill.type}}</li>
                <li>{{bill.category}}</li>
            </ul>
        </div>
        <dl class="dl-horizontal">
            <dt>案由</dt>
            <dd><p>{{bill.abstract}}</p></dd>
            {% if bill.description %}
                <dt>說明</dt>
                <dd><p>{{bill.description}}</p></dd>
            {% endif %}
            {% if bill.methods %}
                <dt>辦法</dt>
                <dd><p>{{bill.methods}}</p></dd>
            {% endif %}
            {% if bill.execution %}
                <dt>執行情形</dt>
                <dd><p>{{bill.execution}}</p></dd>
            {% elif bill.last_action %}
                <dt>執行情形</dt>
                <dd><p>{{bill.last_action}}</p></dd>
            {% endif %}
            {% if bill.remark %}
                <dt>備註</dt>
                <dd><p>{{bill.remark}}</p></dd>
            {% endif %}
            {% if bill.motions %}
                <dt>審議進度</dt>
                <dd>
                    <ul>
                    {% for motion in bill.motions %}
                        <li>
                            {{motion.motion}}{% if motion.date %}（{{motion.date}}）{% endif %}
                            {% if motion.resolution %}<p>{{motion.resolution}}</p>{% endif %}
                        </li>
                    {% endfor %}
                    </ul>
                </dd>
            {% endif %}
        </dl>
        {% for link in bill.links %}
            {% if link.note == 'attach' %}
                <iframe src="https://docs.google.com/gview?embedded=true&url={{link.url}}" style="width:100%; height:50%;" frameborder="0"></iframe>
            {% endif %}
        {% endfor %}
        {% endif %}
    </div>
    <div class="col-sm-4" style="background-color: #ffff001a">
        <form action="" method="post" class="form-inline">
            {% csrf_token %}
            <br>
            <fieldset>
                <label>請輸入最能代表這個提案的標籤：</label>
                {% if user.is_authenticated %}
                    <div class="input-group">
                        <input type="search" name="keyword" id="keyword" class="form-control input-lg" maxlength="20" placeholder="建議:動+名詞，如降屯房稅">
                        <span class="input-group-btn">
                            <button type="submit" class="btn btn-default input-lg">確定</button>
                        </span>
                    </div>
                {% else %}
                    <a href="{% provider_login_url "facebook" %}?next={% url 'bills:bill_detail' county=bill.county bill_id=bill.uid %}" class="btn btn-default"><i class="fa fa-sign-in"> 登入加標籤</i></a>
                {% endif %}
            </fieldset>
            {% with size=3 %}
            {% for standpoint in standpoints_of_bill %}
                {% if forloop.counter0 == size %}
                    <button type="button" class="btn " data-toggle="collapse" data-target="#ref_more"><font>..... 其他標籤 <i class="fa fa-angle-down"></i></font></button>
                    <div id="ref_more" class="collapse">
                {% endif %}
                <h4>{{standpoint.pro}}人認為是
                    <span class="label label-success">{{standpoint}}</span>
                    {% if user.is_authenticated %}
                        {% if standpoint.have_voted %}
                            <button name="against" class="btn" value="{{standpoint.uid}}">取消 +1</button>
                        {% else %}
                            <button name="pro" class="btn" value="{{standpoint.uid}}">+1</button>
                        {% endif %}
                    {% else %}
                    <a href="{% provider_login_url "facebook" %}?next={% url 'bills:bill_detail' county=bill.county bill_id=bill.uid %}" class="btn btn-default"><i class="fa fa-sign-in"> 登入投票</i></a>
                    {% endif %}
                </h4>
            {% endfor %}
            {% if standpoints_of_bill|length > size %}
                </div>
            {% endif %}
            {% endwith %}
        </form>
    </div>
    <div class="modal fade " tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="fa fa-times fa-lg" aria-hidden="true"></i></button>
                    <h4 class="modal-title">網友來協作，讓議員的提案更容易懂</h4>
                </div>
                <div class="modal-body">
                    <p>
                        目前暫由得票最高的標籤：<span class="label label-success">{{standpoints_of_bill.0}}</span> 代表了這個表決
                    </p>
                    <p>
                        參與此提案的議員都會被標註曾參與 <span class="label label-success">{{standpoints_of_bill.0}}</span>，例如：
                    </p>
                    <ul>
                    {% for element in bill.param.sponsors_groupby_party.priproposer.party_list %}
                        {% for councilor in element.councilors %}
                            <li>主提案人：<a href="{% url 'councilors:biller_sp' councilor_id=councilor.councilor_id election_year=bill.election_year %}" target="_blank">{{councilor.name}}</a></li>
                        {% endfor %}
                    {% endfor %}
                    </ul>
                    <p>
                        歡迎在黃色標籤區寫下、投下您的看法，謝謝您的參與讓資料更好！
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">OK</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</div><!--end: row -->
<hr>
<div id="disqus_thread"></div>
{% endblock right %}

{% block script %}
    <script>
        $(document).ready( function() {
            $('#bills').addClass('active');
            $("[rel='tooltip']").tooltip();
            if ($(window).width() > 568)
                $('.modal').modal('show');
        });
    </script>
    {% if bill.param.diversity %}
    {% include "bills/d3/bill_pie.html" %}
    {% endif %}
{% endblock script %}
